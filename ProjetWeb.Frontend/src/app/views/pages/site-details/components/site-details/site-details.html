<ng-container *ngIf="site$ | async as site; else loadingOrError">
  <!-- Mobile-first top bar -->
  <mat-toolbar color="primary" class="sticky top-0 z-10">
    <button mat-icon-button (click)="goBack()" aria-label="Back">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <span class="ml-2 truncate">{{ site.name }}</span>

    <span class="flex-1"></span>
  </mat-toolbar>

  <mat-tab-group class="w-full" mat-stretch-tabs="false" mat-align-tabs="start">
    <!-- Details Tab -->
    <mat-tab label="Details">
      <div class="p-4 flex flex-col gap-4 max-w-3xl mx-auto">
        <app-site-details-tab
          [site]="site"
          [editMode]="editMode()"
          [saving]="saving()"
          (startEdit)="startEdit()"
          (cancelEdit)="cancelEdit()"
          (save)="onDetailsSave($event)"
        />
      </div>
    </mat-tab>

    <!-- Bookings Tab -->
    <mat-tab label="Bookings">
      <div class="p-4 flex flex-col gap-4 max-w-3xl mx-auto">
        <ng-container *ngIf="futureBookings$ | async as bookings">
          <app-bookings-tab
            [bookings]="bookings"
            [courts]="site.courts"
          />
        </ng-container>
      </div>
    </mat-tab>

    <!-- Schedule Tab -->
    <mat-tab label="Schedule">
      <div class="p-4 flex flex-col gap-4 max-w-4xl mx-auto">
        <app-schedule-tab
          [schedule]="site.schedule"
          [saving]="saving()"
          (saveSchedule)="onScheduleSave($event)"
        />
      </div>
    </mat-tab>
  </mat-tab-group>
</ng-container>

<ng-template #loadingOrError>
  <div class="p-4 flex items-center justify-center" *ngIf="loading(); else notFound">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>

  <ng-template #notFound>
    <div class="p-4 max-w-md mx-auto">
      <mat-card>
        <mat-card-header>
          <mat-card-title class="text-base">Site not found</mat-card-title>
        </mat-card-header>
        <mat-card-content class="text-sm text-gray-600">
          The requested site doesnâ€™t exist (or the id is invalid).
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-flat-button color="primary" (click)="goBack()">Back to list</button>
        </mat-card-actions>
      </mat-card>
    </div>
  </ng-template>
</ng-template>
