<!-- View mode -->
@if (!editMode()) {
  <mat-card>
    <mat-card-header>
      <mat-card-title class="text-base">Closed days</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      @if (site().closedDays.length) {
        <div class="flex flex-wrap gap-2">
          @for (d of site().closedDays; track d) {
            <mat-chip>{{ d | date:'yyyy-MM-dd' }}</mat-chip>
          }
        </div>
      } @else {
        <span class="text-sm text-gray-600">No closed days configured</span>
      }
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title class="text-base">Courts</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      @if (site().courts.length) {
        <div class="flex flex-wrap gap-2">
          @for (c of site().courts; track c.number) {
            <mat-chip>Court {{ c.number }}</mat-chip>
          }
        </div>
      } @else {
        <span class="text-sm text-gray-600">No courts configured</span>
      }
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title class="text-base">Revenue</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="flex items-baseline gap-2">
        <span class="text-xl font-semibold">{{ site().revenue | currency:'EUR':'symbol':'1.0-0' }}</span>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="flex items-center gap-3 mt-4">
    <button mat-raised-button color="primary" (click)="startEdit()">
      <mat-icon>edit</mat-icon>
      Edit
    </button>
  </div>
} @else {
  <!-- Edit mode -->
  <form [formGroup]="form" class="flex flex-col gap-4" (ngSubmit)="onSave()">
    <mat-card>
      <mat-card-header>
        <mat-card-title class="text-base">General</mat-card-title>
      </mat-card-header>
      <mat-card-content class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name" placeholder="Site name" />
          @if (form.controls.name.touched && form.controls.name.invalid) {
            <mat-error>
              Name is required (min 2 chars)
            </mat-error>
          }
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title class="text-base">Closed days</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Closed dates (YYYY-MM-DD, comma separated)</mat-label>
          <input matInput formControlName="closedDays" placeholder="2026-01-24, 2026-01-31" />
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title class="text-base">Courts</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Courts (comma separated numbers)</mat-label>
          <input matInput formControlName="courts" placeholder="1, 2, 3" />
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <div class="flex items-center gap-3">
      @if (saving()) {
        <mat-progress-spinner mode="indeterminate" diameter="20"></mat-progress-spinner>
        <span class="text-sm text-gray-600">Savingâ€¦</span>
      }
    </div>

    <div class="flex items-center gap-3">
      <button mat-raised-button color="primary" type="submit" [disabled]="saving()">
        <mat-icon>save</mat-icon>
        Save
      </button>
      <button mat-stroked-button type="button" (click)="cancelEdit()" [disabled]="saving()">
        <mat-icon>close</mat-icon>
        Cancel
      </button>
    </div>
  </form>
}

