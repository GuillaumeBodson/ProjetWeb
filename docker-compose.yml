services:
  # AppHost service - Orchestrates API and Frontend
  apphost:
    build:
      context: .
      dockerfile: ProjetWeb.AppHost/Dockerfile
    ports:
      - "15888:15888"  # Aspire Dashboard HTTP
      - "18889:18889"  # Aspire Dashboard HTTPS/OTLP
      - "5000:5000"    # API Backend
      - "4200:4200"    # Angular Frontend
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - DOTNET_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:15888
      - DOCKER_HOST=unix:///var/run/docker.sock
      - DOTNET_ASPIRE_CONTAINER_RUNTIME=docker
    volumes:
      # Mount Docker socket for container management
      - /var/run/docker.sock:/var/run/docker.sock
      # Mount source code for hot reload (exclude build artifacts)
      - ./ProjetWeb.AppHost:/app/ProjetWeb.AppHost:rw
      - ./ProjetWeb.Api:/app/ProjetWeb.Api:rw
      - ./ProjetWeb.Frontend:/app/ProjetWeb.Frontend:rw
      - ./ProjetWeb.ServiceDefaults:/app/ProjetWeb.ServiceDefaults:rw
      - ./ProjetWeb.slnx:/app/ProjetWeb.slnx:ro
    network_mode: bridge
    container_name: projetweb-apphost

# Note: API and Frontend containers will be managed by the AppHost
# The AppHost will orchestrate these services using Aspire
